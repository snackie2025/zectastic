<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Zcash Flippening Party</title>
  <meta name="description" content="Live Zcash (ZEC) price, marketcap neighbors and music â€” powered by CoinGecko" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg1: #0f1724;
      --bg2: #2b076e;
      --accent: #d946ef;
      --muted: rgba(255,255,255,0.14);
      --glass: rgba(255,255,255,0.06);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; font-family: Inter, system-ui, sans-serif; }
    body {
      background: linear-gradient(135deg, var(--bg1), #3a0ca3, #7209b7);
      color: #fff;
      padding: 20px;
      text-align: center;
      transform: scale(0.8);
      transform-origin: top center;
    }
    h1 { font-size: 32px; margin: 0; font-weight: 800; }
    p.lead { margin: 0; color: rgba(255,255,255,0.75); }

    .container { max-width: 1100px; margin: 0 auto; text-align: center; }
    .card { background: var(--glass); border-radius: 14px; padding: 16px; margin-top: 20px; box-shadow: 0 6px 20px rgba(0,0,0,0.4); }

    .zec-logo { width: 140px; margin-bottom: 10px; }

    .price-big { font-weight: 800; font-size: 64px; line-height: 1; margin: 20px 0; }
    .blink { animation: blinkAnim .9s ease-in-out; }
    @keyframes blinkAnim { 0%{transform:scale(1)} 50%{transform:scale(1.07)} 100%{transform:scale(1)} }

    .neighbor-list { display: flex; flex-direction: column; gap: 6px; align-items: center; }
    .neighbor { background: rgba(255,255,255,0.05); padding: 8px 12px; border-radius: 8px; width: 92%; display: flex; justify-content: space-between; font-size: 14px; }
    .neighbor span { opacity: 0.8; display:flex; flex-direction:column; align-items:flex-end; }

    .zec-center { background: rgba(255,215,0,0.2); font-weight:900; font-size:26px; margin:10px auto; width:92%; border:3px solid gold; padding:16px; border-radius:12px; text-shadow:0 0 15px gold; animation:pulse 2.5s infinite; }
    @keyframes pulse { 0%{box-shadow:0 0 8px gold;} 50%{box-shadow:0 0 30px gold;} 100%{box-shadow:0 0 8px gold;} }

    .muted { color: rgba(255,255,255,0.7); font-size: 13px; }

    .station-buttons { display: flex; justify-content: center; gap: 8px; margin-top: 12px; flex-wrap: wrap; }
    .station-buttons button { flex: 1 1 auto; padding: 8px 12px; border-radius: 8px; border: none; background: rgba(255,255,255,0.1); color: #fff; font-weight: 600; cursor: pointer; transition: background 0.2s; }
    .station-buttons button:hover { background: rgba(255,255,255,0.25); }

    .station-info{display:flex;gap:8px;align-items:center;justify-content:center;margin-top:8px}
    .station-name{font-weight:700}
    .small-muted{color:rgba(255,255,255,0.5);font-size:12px;margin-top:6px}

    .source { margin-top: 20px; font-size: 12px; color: rgba(255,255,255,0.5); }

    @media (max-width:700px){ 
      .price-big{font-size:40px} 
      .zec-logo{width:100px} 
      .zec-center{font-size:20px;padding:12px} 
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="https://z.cash" target="_blank" rel="noopener noreferrer">
      <img src="https://assets.coingecko.com/coins/images/486/large/circle-zcash-color.png" alt="Zcash Logo" class="zec-logo">
    </a>
    <h1>Flippening Party ðŸ¥³</h1>
    <p class="lead">Live $ZEC price & marketcap ranking â€” Pick your own party vibe!</p>

    <div id="price" class="price-big">â€”</div>

    <div class="neighbor-list" id="aboveList"></div>
    <div id="zecCenterContainer"></div>
    <div class="neighbor-list" id="belowList"></div>

    <div class="card">
      <div class="muted">Choose your party vibe ðŸŽ§</div>
      <div class="station-buttons">
        <!-- SomaFM Stations -->
        <button data-url="https://ice1.somafm.com/groovesalad-128-mp3" data-name="Groove Salad">Groove Salad</button>
        <button data-url="https://ice1.somafm.com/spacestation-128-mp3" data-name="Space Station Soma">Space Station Soma</button>
        <button data-url="https://ice1.somafm.com/indiepop-128-mp3" data-name="Indie Pop Rocks!">Indie Pop Rocks!</button>
        <button data-url="https://ice1.somafm.com/secretagent-128-mp3" data-name="Secret Agent">Secret Agent</button>
        <button data-url="https://ice1.somafm.com/u80s-128-mp3" data-name="Underground 80s">Underground 80s</button>
      </div>

      <div class="station-info">
        <div class="station-name" id="stationName">â€”</div>
      </div>

      <audio id="partyAudio" controls autoplay></audio>
      <div class="small-muted" id="audioStatus">Attempting to autoplay. If blocked, click Play.</div>
    </div>

    <p class="muted" id="status">Loading dataâ€¦</p>
    <div class="source">Source: CoinGecko</div>
  </div>

  <script>
    const POLL_MS = 12000; 

    const audioEl = document.getElementById('partyAudio');
    const stationNameEl = document.getElementById('stationName');
    const audioStatusEl = document.getElementById('audioStatus');
    const priceEl = document.getElementById('price');
    const zecCenterContainer = document.getElementById('zecCenterContainer');

    const stationButtons = document.querySelectorAll('.station-buttons button');

    // Function to play a station
    function playStation(btn) {
      const url = btn.dataset.url;
      const name = btn.dataset.name;
      stationNameEl.textContent = name;
      audioEl.src = url;
      audioEl.load();
      audioEl.play().then(() => {
        audioStatusEl.textContent = 'Playing â€” ' + name;
      }).catch(() => {
        audioStatusEl.textContent = 'Autoplay blocked â€” click Play to start: ' + name;
      });
    }

    // Attach click events
    stationButtons.forEach(btn => btn.addEventListener('click', () => playStation(btn)));

    // Autoplay first station on page load
    if (stationButtons.length > 0) {
      playStation(stationButtons[0]);
    }

    audioEl.addEventListener('error', () => {
      audioStatusEl.textContent = 'Stream error â€” please try another station.';
    });

    // CoinGecko fetch
    async function fetchData() {
      try {
        document.getElementById('status').textContent = 'Fetching...';
        const marketsRes = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=250&page=1');
        if (!marketsRes.ok) throw new Error('CoinGecko error: ' + marketsRes.status);
        const data = await marketsRes.json();

        const idx = data.findIndex(c => c.id === 'zcash');
        if (idx === -1) throw new Error('Zcash not found in markets');

        const zec = data[idx];
        const above = data.slice(Math.max(0, idx - 3), idx);
        const below = data.slice(idx + 1, idx + 4);

        const newPrice = zec.current_price;
        const formatPrice = (price) => price != null ? price.toLocaleString(undefined, {style:'currency',currency:'USD',maximumFractionDigits:2}) : 'â€”';
        const formatMarket = (cap) => cap != null ? cap.toLocaleString(undefined, {style:'currency',currency:'USD',maximumFractionDigits:0}) : 'â€”';

        priceEl.textContent = formatPrice(newPrice);
        priceEl.classList.remove('blink');
        void priceEl.offsetWidth; 
        priceEl.classList.add('blink');

        const aboveList = document.getElementById('aboveList');
        aboveList.innerHTML = above.map(c => `
          <div class='neighbor'>
            <b>#${c.market_cap_rank} ${c.symbol.toUpperCase()} â€” ${c.name}</b>
            <span>${formatPrice(c.current_price)}<br>${formatMarket(c.market_cap)}</span>
          </div>`).join('');

        const belowList = document.getElementById('belowList');
        belowList.innerHTML = below.map(c => `
          <div class='neighbor'>
            <b>#${c.market_cap_rank} ${c.symbol.toUpperCase()} â€” ${c.name}</b>
            <span>${formatPrice(c.current_price)}<br>${formatMarket(c.market_cap)}</span>
          </div>`).join('');

        const zecDiv = document.createElement('div');
        zecDiv.className = 'zec-center';
        zecDiv.textContent = `#${zec.market_cap_rank} ZEC - ZCASH | Market Cap: ${formatMarket(zec.market_cap)}`;
        zecCenterContainer.innerHTML = '';
        zecCenterContainer.appendChild(zecDiv);

        document.getElementById('status').textContent = 'Updated ' + new Date().toLocaleTimeString();

      } catch (err) {
        console.error(err);
        document.getElementById('status').textContent = 'API error. Retrying...';
      }
    }

    fetchData();
    setInterval(fetchData, POLL_MS + Math.random() * 3000);
  </script>
</body>
</html>
