<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Zcash Live — Shield Reveal</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&display=swap" rel="stylesheet">

<style>
/* ========================================= */
/* ROOT VARIABLES + SMOOTH THEME CHANGE      */
/* ========================================= */
:root{
  --accent: #57a88a;
  --accent-weak: rgba(87,168,138,0.12);
  --gold: #F3B611;
  --shield-frame-color: #57a88a;
  --bg-panel: rgba(12,12,12,0.92);
  transition: --accent 450ms ease, --shield-frame-color 450ms ease;
}

/* BASE */
html,body{ height:100%; margin:0; background:#000; color:var(--accent);
  font-family:Inter, "Helvetica Neue", Arial, sans-serif; overflow:auto; }

/* BACKGROUND HEX WALL */
.hex-wallpaper{ position:fixed; inset:0; z-index:0; pointer-events:none; opacity:0.03; color:#f3b611;
  font-family:ui-monospace,monospace; font-size:10px; display:flex; flex-wrap:wrap;
  align-items:center; justify-content:center; letter-spacing:6px;
  background:repeating-linear-gradient(90deg, transparent 0 10px, rgba(255,255,255,0.002) 10px 11px); }
.hex-wallpaper .line{ width:100%; text-align:center; opacity:0.85; animation:hexDrift 30s linear infinite alternate; }
@keyframes hexDrift{ from{ transform:translateX(-4%) } to{ transform:translateX(4%) } }

/* CENTER SHIELD */
.center{ position:relative; z-index:2; min-height:100vh; display:flex; align-items:center; justify-content:center;
  flex-direction:column; padding:32px; box-sizing:border-box; }

.shield{ position:relative; width:min(84vw,920px); max-width:920px; padding:48px 26px; display:flex; flex-direction:column;
  align-items:center; justify-content:center; gap:18px; transition:box-shadow 350ms ease, transform 300ms ease; }

.shield-bg{ position:absolute; inset:0; border-radius:22px;
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.16));
  border:1px solid rgba(255,255,255,0.05); backdrop-filter:blur(8px) saturate(1.05); }

/* SHIELD FRAME */
.shield-frame{ position:absolute; left:50%; top:16px; transform:translateX(-50%); width:86%; opacity:0.25;
  pointer-events:none; stroke:var(--shield-frame-color); transition:stroke 600ms ease, opacity 600ms ease; }
@keyframes shieldPartyGlow { 0%{ filter:hue-rotate(0deg) brightness(1); } 50%{ filter:hue-rotate(40deg) brightness(1.18); } 100%{ filter:hue-rotate(0deg) brightness(1); } }
.shield.party-active .shield-frame{ animation: shieldPartyGlow 4.5s linear infinite; }

/* PRICE */
.price{ font-family:'Orbitron'; font-weight:700; font-size:clamp(36px,12vw,88px); letter-spacing:-0.02em;
  color:var(--accent); position:relative; transition:color 200ms ease, transform 200ms ease, background 220ms ease;
  padding:6px 12px; border-radius:10px; min-width:160px; text-align:center; }

/* update highlights */
.price.updated{ transform:translateY(-2px) scale(1.02); background:rgba(255,255,255,0.03); box-shadow:0 6px 18px rgba(0,0,0,0.45); }
.price.remote-updated{ transform:translateY(-3px) scale(1.035); background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); box-shadow:0 10px 30px rgba(0,0,0,0.55); }

/* ZEC DETAILS */
.zec-details{ display:flex; justify-content:center; width:100%; margin-top:6px; }
.zec-card{ background:rgba(255,255,255,0.01); padding:8px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04);
  display:flex; gap:12px; align-items:center; color:var(--accent); transition:color 600ms ease, border 600ms ease; position:relative; overflow:hidden; }

/* shimmer */
@keyframes shimmerSweep{ 0%{ transform:translateX(-120%) } 60%{ transform:translateX(120%) } 100%{ transform:translateX(120%) } }
.shimmer{ position:absolute; top:0; left:0; bottom:0; width:40%; background:linear-gradient(115deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.18) 50%, rgba(255,255,255,0) 100%);
  transform:translateX(-120%); pointer-events:none; }

/* PARTY LIST - smooth reveal */
.party-list{
  display:flex; flex-direction:column; gap:8px; width:100%; max-height:0; overflow:hidden; margin-top:8px;
  opacity:0; transform:translateY(8px) scale(0.995); transition: max-height 520ms cubic-bezier(.05,.9,.2,1), opacity 420ms ease, transform 420ms cubic-bezier(.05,.9,.2,1);
}

/* when active, expand and show with animation */
.shield.party-active .party-list{
  max-height:420px; opacity:1; transform:translateY(0) scale(1);
}

/* party content card style - a little party pop */
.project-row{
  background:rgba(255,255,255,0.01); padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.03);
  display:flex; justify-content:space-between; gap:12px; align-items:center; transform:translateY(6px); opacity:0;
  transition:transform 420ms ease, opacity 420ms ease;
}

/* animate children in when party opens (stagger) */
.shield.party-active .project-row{ transform:translateY(0); opacity:1; }

/* leader (first item) gold highlight */
.project-row.leader{
  border-color: rgba(243,182,17,0.35);
  box-shadow: 0 8px 28px rgba(243,182,17,0.06);
  background: linear-gradient(180deg, rgba(243,182,17,0.02), rgba(255,255,255,0.005));
}
.project-row.leader .title { color: var(--gold); font-weight:800; }

/* small meta text */
.project-row .meta{ font-size:12px; opacity:.82; }

/* MODE BUTTONS */
.mode-toggle{ position:fixed; right:40px; top:12px; z-index:10; background:rgba(255,255,255,0.02); padding:6px; border-radius:8px;
  border:1px solid rgba(255,255,255,0.04); display:flex; gap:8px; }
.mode-toggle button{ background:transparent; border:0; padding:8px 10px; font-weight:700; cursor:pointer; color:#fff; border-radius:6px; }
.mode-toggle button.active{ background:rgba(255,255,255,0.04); color:var(--accent); }

/* CONTROLS STACK (align radio + party button) */
.controls-stack{
  position:fixed; right:16px; bottom:16px; z-index:50;
  display:flex; flex-direction:column; gap:12px; align-items:flex-end;
}

/* headphone button (top of stack) */
.headphone-btn{ display:flex; align-items:center; justify-content:center; width:56px; height:56px; border-radius:999px;
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.25)); border:1px solid rgba(255,255,255,0.04); color:var(--accent);
  cursor:pointer; transition: transform 260ms cubic-bezier(.2,.9,.3,1), box-shadow 220ms ease; }
.headphone-btn:hover{ transform:translateY(-4px); box-shadow:0 8px 30px rgba(0,0,0,0.6); }

/* party button (below) */
.party-btn{
  padding:10px 14px; border-radius:10px; background:rgba(255,255,255,0.02); color:var(--accent); border:1px solid rgba(255,255,255,0.04);
  cursor:pointer; backdrop-filter:blur(6px); transition: transform 200ms ease, box-shadow 220ms ease;
}
.party-btn:hover{ transform:translateY(-4px); box-shadow:0 8px 26px rgba(0,0,0,0.45); }

/* radio panel - smooth slide + fade */
.radio-panel{ position:fixed; right:16px; bottom:86px; z-index:40; width:320px; max-width:calc(100vw - 32px);
  background:var(--bg-panel); border-radius:12px; padding:12px; box-shadow: 0 8px 30px rgba(0,0,0,0.6); border:1px solid rgba(255,255,255,0.04);
  display:flex; flex-direction:column; gap:8px; opacity:0; transform:translateY(12px) scale(0.995); pointer-events:none;
  transition: opacity 320ms ease, transform 360ms cubic-bezier(.05,.9,.2,1); }

/* visible */
.radio-panel.open{ opacity:1; transform:translateY(0) scale(1); pointer-events:auto; }

/* simple station row - only show name and active indicator */
.station{ display:flex; align-items:center; justify-content:space-between; padding:10px; border-radius:10px; cursor:pointer;
  background:rgba(255,255,255,0.01); border:1px solid rgba(255,255,255,0.03); transition: transform 180ms ease, border-color 220ms ease; }
.station:hover{ transform:translateY(-3px); }
.station.active{ border-color:rgba(87,168,138,0.28); box-shadow:0 6px 20px rgba(87,168,138,0.06); }

/* controls row (Stop / Mute) */
.radio-controls{ display:flex; gap:8px; justify-content:flex-end; align-items:center; }
.icon-btn{ background:transparent; border:1px solid rgba(255,255,255,0.04); padding:8px 10px; border-radius:8px; color:var(--accent); cursor:pointer; }
.icon-btn.active{ background:rgba(255,255,255,0.03); }

/* status small text */
.small{ font-size:12px; opacity:.78; }

/* responsive tweaks */
@media (max-width:420px){
  .radio-panel{ width:calc(100vw - 28px); right:14px; bottom:86px; }
  .price{ font-size:clamp(28px,14vw,64px) }
}
</style>
</head>

<body>

<div class="hex-wallpaper">
  <div class="line">3f a1 0c 9b 4d 8e f2 7a c9 1b 55 aa 7f e3 2d</div>
  <div class="line">b4 6a 9d 0f e1 3c 7b dd 18 90 2a 5e 33 c1 8f</div>
  <div class="line">9c e4 1b 7f 2d 5a 80 3c b1 4e 6a 0f d3 77 9a</div>
</div>

<div class="center">
  <div class="shield" id="shieldRoot">
    <div class="shield-bg"></div>

    <svg class="shield-frame" viewBox="0 0 100 120">
      <path d="M50 4 L86 18 V48 C86 78 66 106 50 116 34 106 14 78 14 48 V18 Z"
            fill="none" stroke="currentColor" stroke-width="1.5"/>
    </svg>

    <div class="price" id="price">—</div>

    <div class="zec-details">
      <div class="zec-card">
        <div style="font-weight:900">ZEC</div>

        <div>
          <div style="font-size:12px;opacity:.8">Supply</div>
          <div id="zecSupply">—</div>
        </div>

        <div>
          <div style="font-size:12px;opacity:.8">Market cap</div>
          <div id="zecMarketCap">—</div>
        </div>

        <div class="shimmer" id="zecShimmer"></div>
      </div>
    </div>

    <div class="party-list" id="partyList" aria-live="polite"></div>

    <div id="partyControls" style="display:none">
      <button id="partyBack" class="party-back">Go Back</button>
    </div>
  </div>
</div>

<div class="mode-toggle">
  <button id="modePrivacy" class="active">Privacy</button>
  <button id="modeGold">Gold</button>
</div>

<!-- Controls stack - aligns radio + flippening button -->
<div class="controls-stack" id="controlsStack">
  <button class="headphone-btn" id="radioToggleBtn" aria-label="Toggle radio" title="Radio">
    <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" style="display:block">
      <path d="M3 13v-2a9 9 0 0 1 18 0v2"></path>
      <path d="M5 13v6a2 2 0 0 0 2 2h1v-8H5z"></path>
      <path d="M19 13v6a2 2 0 0 1-2 2h-1v-8h3z"></path>
    </svg>
  </button>

  <button id="partyBtn" class="party-btn">ZEC Flippening Party</button>
</div>

<!-- RADIO PANEL -->
<div class="radio-panel" id="radioPanel" role="region" aria-label="Radio panel">
  <!-- Station 1 (Dance 1) -->
  <!-- Sunshine Live EDM (public stream endpoint) -->
  <div class="station" data-stream="https://stream.sunshine-live.de/edm/mp3-128" data-index="0">
    <div>
      <div style="font-weight:700" class="title">Dance 1</div>
      <div class="small">Sunshine EDM</div>
    </div>
    <div class="small status">Stopped</div>
  </div>

  <!-- Station 2 (Dance 2) -->
  <!-- Dance.FM MP3 HQ -->
  <div class="station" data-stream="https://streams.dancefm.net/mp3-hq" data-index="1">
    <div>
      <div style="font-weight:700" class="title">Dance 2</div>
      <div class="small">Dance.FM HQ</div>
    </div>
    <div class="small status">Stopped</div>
  </div>

  <div style="display:flex;justify-content:flex-end;align-items:center;margin-top:6px">
    <div class="radio-controls">
      <button id="stopAll" class="icon-btn">Stop</button>
      <button id="muteBtn" class="icon-btn">Mute</button>
    </div>
  </div>

  <!-- audio elements -->
  <audio id="audio0" crossorigin="anonymous"></audio>
  <audio id="audio1" crossorigin="anonymous"></audio>
</div>

<script>
/* Elements & helpers */
const priceEl = document.getElementById("price");
const zecSupplyEl = document.getElementById("zecSupply");
const zecMarketCapEl = document.getElementById("zecMarketCap");
const shimmerEl = document.getElementById("zecShimmer");

const shieldRoot = document.getElementById("shieldRoot");
const partyList = document.getElementById("partyList");
const partyBtn = document.getElementById("partyBtn");
const partyBack = document.getElementById("partyBack");
const partyControls = document.getElementById("partyControls");

const modePrivacy = document.getElementById("modePrivacy");
const modeGold = document.getElementById("modeGold");

/* Radio elements */
const radioToggleBtn = document.getElementById("radioToggleBtn");
const radioPanel = document.getElementById("radioPanel");
const stopAllBtn = document.getElementById("stopAll");
const muteBtn = document.getElementById("muteBtn");
const stationEls = Array.from(document.querySelectorAll(".station"));
const audioEls = [ document.getElementById("audio0"), document.getElementById("audio1") ];

let isMuted = false;
let activeIndex = null;

/* formatting */
function formatMoneyCompact(v){
  if(!isFinite(v)) return "—";
  if (Math.abs(v) >= 1e12) return "$" + (v/1e12).toFixed(2) + "T";
  if (Math.abs(v) >= 1e9) return "$" + (v/1e9).toFixed(2) + "B";
  if (Math.abs(v) >= 1e6) return "$" + (v/1e6).toFixed(2) + "M";
  if (Math.abs(v) >= 1e3) return "$" + (v/1e3).toFixed(2) + "k";
  return "$" + v.toLocaleString("en-US",{maximumFractionDigits:2});
}
function formatPriceFullFixed2(v){
  if(!isFinite(v)) return "—";
  const parts = Number(v).toFixed(2);
  const [intPart, frac] = parts.split(".");
  return "$" + Number(intPart).toLocaleString("en-US") + "." + frac;
}

/* PRICE state */
let lastFetchedPrice = null;
let displayedPrice = null;
let perSecondTicker = null;
let fetchTicker = null;

/* Fetch ZEC price (remote) */
async function fetchZecPrice(){
  try{
    const r = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=zcash&vs_currencies=usd");
    const j = await r.json();
    const val = j?.zcash?.usd;
    if (val == null) return;

    lastFetchedPrice = Number(val);
    displayedPrice = lastFetchedPrice;
    priceEl.textContent = formatPriceFullFixed2(displayedPrice);
    priceEl.classList.add("remote-updated");
    setTimeout(()=> priceEl.classList.remove("remote-updated"), 700);
  }catch(e){
    console.error("fetchZecPrice error", e);
  }
}

/* Fetch details */
let zecCirculatingSupply = null;
async function fetchZecDetails(){
  try{
    const r = await fetch("https://api.coingecko.com/api/v3/coins/zcash?localization=false&tickers=false&market_data=true");
    const j = await r.json();
    const s = j?.market_data?.circulating_supply ?? null;
    const m = j?.market_data?.market_cap?.usd ?? null;
    if(s){ zecCirculatingSupply = Number(s); zecSupplyEl.textContent = Number(s).toLocaleString("en-US"); }
    if(m) zecMarketCapEl.textContent = formatMoneyCompact(m);

    shimmerEl.style.animation = "none";
    void shimmerEl.offsetWidth;
    shimmerEl.style.animation = "shimmerSweep 1.8s ease";
  }catch(e){ console.error("fetchZecDetails error", e); }
}

/* initialize */
fetchZecPrice();
fetchZecDetails();
fetchTicker = setInterval(fetchZecPrice, 15000);
setInterval(fetchZecDetails, 60000);

/* per-second small increments (cents) */
function startPerSecondTicker(){
  if(perSecondTicker) return;
  perSecondTicker = setInterval(()=>{
    if(displayedPrice == null) return;
    // small step to move cents (ensure visible changes with 2 decimals)
    const base = Math.max(0.005, Math.abs(displayedPrice) * 0.00002);
    const jitter = (Math.random() * base) * 0.7 + (base * 0.02);
    displayedPrice = Number(displayedPrice) + jitter;
    priceEl.textContent = formatPriceFullFixed2(displayedPrice);
    priceEl.classList.add("updated");
    setTimeout(()=> priceEl.classList.remove("updated"), 220);
  }, 1000);
}
startPerSecondTicker();

/* PARTY - top 5 with smooth reveal, first is gold */
let partyOn = false;
partyBtn.addEventListener("click", ()=> partyOn? closeParty() : openParty());
if(document.getElementById("partyBack")) document.getElementById("partyBack").addEventListener("click", closeParty);

async function openParty(){
  partyOn = true;
  shieldRoot.classList.add("party-active");
  partyControls.style.display = "block";
  await loadPartyList();
}
function closeParty(){
  partyOn = false;
  shieldRoot.classList.remove("party-active");
  partyControls.style.display = "none";
}

async function loadPartyList(){
  partyList.innerHTML = `<div style="padding:12px;text-align:center;opacity:.8">Loading top 5 by market cap...</div>`;

  try{
    if(!zecCirculatingSupply) await fetchZecDetails();

    const r = await fetch("https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=5&page=1");
    const mk = await r.json();
    if(!Array.isArray(mk) || mk.length === 0){ partyList.innerHTML = `<div style="padding:12px;text-align:center;opacity:.8">No data</div>`; return; }

    // clear then insert with staggered animation
    partyList.innerHTML = "";
    mk.forEach((proj, idx) => {
      const mcap = proj.market_cap ?? 0;
      const p = proj.current_price ?? 0;
      const sym = proj.symbol ? proj.symbol.toUpperCase() : "";
      const zecIf = (zecCirculatingSupply && zecCirculatingSupply > 0) ? (mcap / zecCirculatingSupply) : null;

      const row = document.createElement("div");
      row.className = "project-row" + (idx === 0 ? " leader" : "");
      row.style.transitionDelay = (idx * 60) + "ms"; // subtle stagger
      row.innerHTML = `
        <div>
          <div class="title" style="font-weight:700">${proj.name}</div>
          <div style="opacity:0.8">${sym}</div>
          <div class="meta">Market cap · ${formatMoneyCompact(mcap)}</div>
        </div>
        <div style="text-align:right">
          <div>${formatPriceFullFixed2(p)} · <span class="meta">ZEC if: <strong>${zecIf ? formatPriceFullFixed2(zecIf) : "—"}</strong></span></div>
        </div>`;
      partyList.appendChild(row);
    });

  }catch(e){
    console.error("loadPartyList error", e);
    partyList.innerHTML = `<div style='padding:12px;color:#f88;text-align:center'>Failed to load top 5</div>`;
  }
}

/* MODE SWITCH */
function setMode(m){
  if(m==="gold"){
    document.documentElement.style.setProperty("--accent", "#F3B611");
    document.documentElement.style.setProperty("--shield-frame-color","#F3B611");
    modeGold.classList.add("active"); modePrivacy.classList.remove("active");
  } else {
    document.documentElement.style.setProperty("--accent", "#57a88a");
    document.documentElement.style.setProperty("--shield-frame-color", "#57a88a");
    modePrivacy.classList.add("active"); modeGold.classList.remove("active");
  }
}
modePrivacy.addEventListener("click", ()=> setMode("privacy"));
modeGold.addEventListener("click", ()=> setMode("gold"));
setMode("privacy");

/* ============================
   RADIO INTERACTIONS (simplified)
   - station rows clickable (Dance 1 / Dance 2)
   - Stop and Mute available
   ============================ */

radioToggleBtn.addEventListener("click", (e) => {
  e.stopPropagation();
  radioPanel.classList.toggle("open");
  radioToggleBtn.animate([{ transform: 'translateY(0)' }, { transform: 'translateY(-6px)' }, { transform: 'translateY(0)' }], { duration: 260, easing: 'cubic-bezier(.2,.9,.3,1)' });
});

// close panel on outside click
document.addEventListener("click", (e) => {
  if(!radioPanel.classList.contains("open")) return;
  if(!radioPanel.contains(e.target) && !radioToggleBtn.contains(e.target)){
    radioPanel.classList.remove("open");
  }
});
radioPanel.addEventListener("click", (e)=> e.stopPropagation());

/* set audio src for each audio element */
stationEls.forEach((el, idx) => {
  const url = el.dataset.stream;
  const audio = audioEls[idx];
  if(url) audio.src = url;
});

/* clicking a station toggles play/stop */
stationEls.forEach((el, idx) => {
  const audio = audioEls[idx];
  const status = el.querySelector(".status");
  el.addEventListener("click", async (e) => {
    e.stopPropagation();
    // if already active, stop it
    if(activeIndex === idx){
      audio.pause();
      audio.currentTime = 0;
      el.classList.remove("active");
      status.textContent = "Stopped";
      activeIndex = null;
      return;
    }
    // stop other audio
    audioEls.forEach((a, i) => {
      if(i !== idx){ a.pause(); try{ a.currentTime = 0; }catch{} stationEls[i].classList.remove("active"); stationEls[i].querySelector(".status").textContent = "Stopped"; }
    });
    // play selected
    try{
      audio.muted = isMuted;
      await audio.play();
      activeIndex = idx;
      el.classList.add("active");
      status.textContent = "Playing";
    }catch(err){
      console.warn("Playback may be blocked by browser autoplay policy:", err);
      status.textContent = "Playback blocked";
    }
  });
});

/* Stop All */
stopAllBtn.addEventListener("click", () => {
  audioEls.forEach((a, i) => { a.pause(); try{ a.currentTime = 0; }catch{} stationEls[i].classList.remove("active"); stationEls[i].querySelector(".status").textContent = "Stopped"; });
  activeIndex = null;
});

/* Mute toggle */
muteBtn.addEventListener("click", () => {
  isMuted = !isMuted;
  audioEls.forEach(a => a.muted = isMuted);
  muteBtn.classList.toggle("active", isMuted);
  muteBtn.textContent = isMuted ? "Muted" : "Mute";
});

/* prevent pointer-events weirdness when audio tags not ready */
audioEls.forEach(a => { a.preload = "none"; });

</script>
</body>
</html>
