<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Zcash Live â€” Shield Reveal</title>

<!-- Orbitron for techy / angular numerals -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&display=swap" rel="stylesheet">

<style>
  :root{
    --zcash-gold: #F3B611;
    --gold-glow: rgba(243,182,17,0.14);
    --bg-dark: #000;
    --charcoal: #070707;
    --privacy-green: #57a88a;
    --muted: rgba(255,255,255,0.06);
    --ui-contrast: rgba(255,255,255,0.06);
  }

  /* page basics */
  html,body { height:100%; margin:0; background:var(--bg-dark); color:var(--zcash-gold); font-family: Inter, "Helvetica Neue", Arial, sans-serif; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; overflow:hidden; }

  /* encrypted wallpaper (very subtle hex characters drifting) */
  .hex-wallpaper {
    position:fixed; inset:0; z-index:0; pointer-events:none; opacity:0.03; color:#f3b611;
    font-family: ui-monospace, "SFMono-Regular", Menlo, Monaco, "Roboto Mono", "Helvetica Neue", monospace;
    font-size:10px; display:flex; flex-wrap:wrap; align-items:center; justify-content:center; letter-spacing:6px;
    transform: translate3d(0,0,0);
    background: repeating-linear-gradient(90deg, transparent 0 10px, rgba(255,255,255,0.002) 10px 11px);
  }
  .hex-wallpaper .line { width:100%; text-align:center; white-space:nowrap; user-select:none; opacity:0.85; }
  @keyframes hexDrift { from { transform: translateX(-6%); } to { transform: translateX(6%); } }
  .hex-wallpaper .line { animation: hexDrift 24s linear infinite alternate; }

  /* container */
  .center {
    position:relative; z-index:2; height:100vh; display:flex; align-items:center; justify-content:center; flex-direction:column;
    padding:32px; box-sizing:border-box;
  }

  /* Shield container */
  .shield {
    position:relative;
    width: min(84vw, 820px);
    max-width:820px;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:48px 26px;
    box-sizing:border-box;
    gap:18px;
  }

  /* Frosted glass shield background */
  .shield-bg {
    position:absolute; inset:0; border-radius:22px; z-index:0;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.14));
    border: 1px solid rgba(255,255,255,0.04);
    backdrop-filter: blur(8px) saturate(1.05);
    box-shadow: 0 18px 80px rgba(0,0,0,0.6), 0 4px 18px rgba(243,182,17,0.03);
  }

  /* shield outline (svg inserted) sits behind text */
  .shield-frame { position:absolute; z-index:1; left:50%; top:36px; transform:translateX(-50%); width:80%; opacity:0.12; pointer-events:none; }

  /* block pulse (square behind number) */
  .block-pulse {
    position:absolute; z-index:1; width:42%; height:48%; background:linear-gradient(180deg, rgba(243,182,17,0.06), rgba(243,182,17,0.03)); border-radius:6px;
    transform:translateY(6%) scale(1); transition: transform 180ms ease, box-shadow 180ms ease, opacity 200ms ease;
    filter: blur(0.6px);
    display:block;
  }

  /* price text container */
  .price-wrap {
    position:relative; z-index:2; display:flex; align-items:center; justify-content:center; flex-direction:column;
    width:100%;
  }

  /* the numeric price: big, angular, Orbitron */
  .price {
    font-family: 'Orbitron', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    font-weight:700;
    font-size:clamp(36px, 12vw, 124px);
    line-height:0.9;
    letter-spacing: -0.02em;
    color: var(--zcash-gold);
    text-align:center;
    position:relative;
    z-index:3;
    -webkit-font-smoothing:antialiased;
    transition: opacity 220ms ease, transform 180ms cubic-bezier(.2,.9,.3,1);
    opacity: 0.6; /* starts slightly hidden */
    will-change: opacity, transform;
  }

  /* faint gold glow behind price */
  .price::after {
    content:"";
    position:absolute; inset:auto -8% -8% -8%;
    z-index:-1;
    background: radial-gradient(closest-side, var(--gold-glow), transparent 40%);
    filter: blur(16px);
    opacity:0.9;
    pointer-events:none;
  }

  /* pixel mask to simulate pixelated -> unpixelated reveal */
  .pixel-mask {
    position:absolute; z-index:4; inset:0; pointer-events:none; mix-blend-mode:overlay;
    background-image:
      linear-gradient(0deg, rgba(0,0,0,0.035) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,0,0,0.035) 1px, transparent 1px);
    background-size: 6px 6px; opacity:0.12; transition: opacity 90ms linear, transform 90ms linear;
    border-radius:18px;
  }

  /* proof lines sliding */
  .proof-lines { position:absolute; z-index:1; inset:0; pointer-events:none; overflow:visible; }
  .proof-lines .line { position:absolute; width:140%; height:2px; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.06), transparent); opacity:0.08; transform:rotate(-18deg); left:-20%; top:44%; transition: transform 180ms ease, opacity 200ms ease; }
  .proof-lines .line.two { top:56%; transform:rotate(18deg); }

  /* reveal / pixel states */
  .reveal-ready .pixel-mask { opacity:0.18; transform: scale(1.02); }
  .reveal-active .pixel-mask { opacity:0; transform: scale(1); transition: opacity 80ms linear, transform 80ms linear; }
  .reveal-active .price { opacity:1; transform: translateY(-6px) scale(1.01); }
  .reveal-fade .price { transition: opacity 600ms ease; opacity:0.72; transform:none; }

  /* small top-right dual mode toggle */
  .mode-toggle {
    position: fixed; right:12px; top:12px; z-index:6;
    display:flex; gap:8px; align-items:center;
    background: rgba(255,255,255,0.02); border-radius:8px; padding:6px; border: 1px solid rgba(255,255,255,0.04);
    backdrop-filter: blur(6px);
  }
  .mode-toggle button { background:transparent; border:0; color: #fff; padding:8px 10px; border-radius:6px; cursor:pointer; font-weight:700; font-family:inherit; opacity:0.9; }
  .mode-toggle button.active { background: linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); color:var(--zcash-gold); }

  /* subtle footer control to reveal audio/player (hidden by default to keep price-only) */
  .player-toggle {
    position: fixed; right:12px; bottom:12px; z-index:6;
    background: rgba(255,255,255,0.02); border-radius:8px; padding:8px; width:44px; height:44px; display:flex; align-items:center; justify-content:center; cursor:pointer;
    border:1px solid rgba(255,255,255,0.04); color:white;
  }

  /* hidden control UI (keeps functionality but out of sight) */
  .controls {
    position: fixed; right:12px; bottom:70px; z-index:7; display:flex; flex-direction:column; gap:8px; opacity:0; transform: translateY(8px); pointer-events:none;
  }
  .controls.show { opacity:1; transform:none; pointer-events:auto; }

  .controls .btn { appearance:none; border-radius:8px; padding:8px 12px; border: 1px solid rgba(255,255,255,0.04); background:transparent; color: #fff; cursor:pointer; font-weight:700; }

  /* small responsive adjustments */
  @media (max-width:640px){
    .shield { padding:28px 18px; }
    .price { font-size: clamp(32px, 18vw, 72px); }
    .block-pulse { width:60%; height:50%; }
  }
</style>
</head>
<body>

  <!-- encrypted wallpaper (hex lines) -->
  <div class="hex-wallpaper" aria-hidden="true">
    <!-- create several repeated lines of pseudo-random hex to create texture -->
    <div class="line">3f a1 0c 9b 4d 8e f2 7a c9 1b 55 aa 7f e3 2d</div>
    <div class="line">b4 6a 9d 0f e1 3c 7b dd 18 90 2a 5e 33 c1 8f</div>
    <div class="line">9c e4 1b 7f 2d 5a 80 3c b1 4e 6a 0f d3 77 9a</div>
  </div>

  <div class="center">

    <div class="shield reveal-ready" id="shieldRoot" aria-live="polite">
      <div class="shield-bg" aria-hidden="true"></div>

      <!-- block pulse behind number -->
      <div class="block-pulse" id="blockPulse" aria-hidden="true"></div>

      <!-- proof lines -->
      <div class="proof-lines" aria-hidden="true">
        <div class="line one"></div>
        <div class="line two"></div>
      </div>

      <!-- shield SVG frame (thin outline) -->
      <svg class="shield-frame" viewBox="0 0 100 120" preserveAspectRatio="xMidYMid meet" aria-hidden="true">
        <path d="M50 4 L86 18 V48 C86 78 66 106 50 116 34 106 14 78 14 48 V18 Z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round" stroke-linecap="round" />
      </svg>

      <div class="price-wrap">
        <!-- pixel mask sits above price and animates on reveal -->
        <div class="pixel-mask" id="pixelMask" aria-hidden="true"></div>

        <!-- price text -->
        <div class="price" id="price">â€”</div>
      </div>
    </div>

  </div>

  <!-- small UI: mode toggle -->
  <div class="mode-toggle" role="toolbar" aria-label="Display mode">
    <button id="modePrivacy" class="active" title="Privacy Mode">Privacy</button>
    <button id="modeGold" title="Zcash Gold Mode">Gold</button>
  </div>

  <!-- player toggle + hidden controls (kept out of visual noise but available) -->
  <div class="player-toggle" id="playerToggle" title="Show player controls">ðŸŽ§</div>

  <div class="controls" id="controls" aria-hidden="true">
    <button class="btn station" id="stationDelta">Delta Radio â€” Live</button>
    <button class="btn station" id="stationSunSP4">Sunshine Tech</button>
    <button class="btn station" id="stationSunSP6">Sunshine Charts</button>
    <button class="btn" id="stopBtn">Stop</button>
    <button class="btn" id="muteBtn">Mute</button>
  </div>

  <!-- audio (present but hidden) -->
  <audio id="radio" crossorigin="anonymous" preload="none"></audio>

<script>
/* ============================
  Zcash-themed Price Reveal page
  - Shield reveal + pixel mask + block pulse + proof lines
  - Dual modes: Privacy (dark/green) and Gold (zcash gold)
  - Keeps price polling (CoinGecko); on fetch failure we keep last displayed price
  - Radio player functionality preserved (controls hidden by default)
  ============================ */

const priceEl = document.getElementById('price');
const shieldRoot = document.getElementById('shieldRoot');
const pixelMask = document.getElementById('pixelMask');
const blockPulse = document.getElementById('blockPulse');
const proofLines = document.querySelectorAll('.proof-lines .line');

const controlsWrap = document.getElementById('controls');
const playerToggle = document.getElementById('playerToggle');

const modePrivacy = document.getElementById('modePrivacy');
const modeGold = document.getElementById('modeGold');

const radioEl = document.getElementById('radio');

let lastPrice = null;
let lastDisplayed = priceEl.textContent || 'â€”';

/* ---------------------------
  Formatting & polling
--------------------------- */
const formatPrice = n => {
  const v = Number(n);
  if (!isFinite(v)) return 'â€”';
  return new Intl.NumberFormat('en-US', {maximumFractionDigits: 2, minimumFractionDigits: 2}).format(v);
};

async function fetchPrice(){
  try{
    const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=zcash&vs_currencies=usd');
    if(!res.ok) throw new Error('network');
    const json = await res.json();
    const val = json?.zcash?.usd;
    if (val == null) throw new Error('bad response');
    const formatted = formatPrice(val);

    // run reveal animation & update
    triggerRevealUpdate(formatted, val);

    // color hint (minor): green if up, pink if down
    if (lastPrice !== null){
      if (val > lastPrice) priceEl.style.color = getComputedStyle(document.documentElement).getPropertyValue('--accent-bright') || '#57a88a';
      else if (val < lastPrice) priceEl.style.color = getComputedStyle(document.documentElement).getPropertyValue('--accent-down') || '#ff85a1';
      else priceEl.style.color = getComputedStyle(document.documentElement).getPropertyValue('--zcash-gold') || '#F3B611';
    } else {
      // first load -> use neutral gold
      priceEl.style.color = getComputedStyle(document.documentElement).getPropertyValue('--zcash-gold') || '#F3B611';
    }

    lastPrice = val;
    lastDisplayed = formatted;
  }catch(e){
    // keep lastDisplayed unchanged
    console.warn('fetch error, keeping last price', e);
  }
}

// initial fetch & steady poll (1s as before; changeable)
fetchPrice();
const pollInterval = 1000;
setInterval(fetchPrice, pollInterval);

/* ---------------------------
  Reveal animation plumbing
--------------------------- */
let revealTimeout = null;
function triggerRevealUpdate(formattedText, numericValue){
  // set text immediately (so screen-readers get updated)
  priceEl.textContent = formattedText;

  // Shield states: reveal-ready -> reveal-active -> reveal-fade -> ready
  shieldRoot.classList.remove('reveal-active','reveal-fade');
  // quickly show pixel mask (simulate encrypted)
  shieldRoot.classList.add('reveal-ready');

  // small block pulse (instant)
  blockPulse.style.opacity = '1';
  blockPulse.style.transform = 'translateY(0%) scale(1.04)';
  blockPulse.style.boxShadow = '0 8px 30px rgba(243,182,17,0.12)';
  // clear any existing timeouts
  if (revealTimeout) clearTimeout(revealTimeout);

  // next tick: reveal
  setTimeout(()=> {
    shieldRoot.classList.remove('reveal-ready');
    shieldRoot.classList.add('reveal-active');
    // animate proof lines sliding
    proofLines.forEach((l,i)=> {
      l.style.transform = (i===0) ? 'translateX(18%) rotate(-18deg)' : 'translateX(-18%) rotate(18deg)';
      l.style.opacity = '0.12';
    });
    // remove block pulse visual quickly
    blockPulse.style.transform = 'translateY(-4%) scale(1.02)';
    blockPulse.style.boxShadow = '0 18px 56px rgba(243,182,17,0.06)';
  }, 40); // tiny delay

  // after short reveal, fade back to semi-transparent state (ZK vibe)
  revealTimeout = setTimeout(()=> {
    shieldRoot.classList.remove('reveal-active');
    shieldRoot.classList.add('reveal-fade');
    // reset proof lines
    proofLines.forEach((l)=> {
      l.style.transform = 'translateX(0%)';
      l.style.opacity = '0.06';
    });
    // remove block pulse highlight gently
    blockPulse.style.transform = 'translateY(6%) scale(1)';
    blockPulse.style.boxShadow = 'none';
  }, 420); // reveal visible for ~380ms total

  // final cleanup: keep in ready state
  setTimeout(()=> {
    shieldRoot.classList.remove('reveal-fade');
  }, 820);
}

/* ---------------------------
  Clock (small neat element)
--------------------------- */
const clockEl = document.createElement('div');
clockEl.style.position = 'fixed';
clockEl.style.left = '14px';
clockEl.style.top = '14px';
clockEl.style.zIndex = '6';
clockEl.style.background = 'linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.18))';
clockEl.style.color = 'rgba(255,255,255,0.9)';
clockEl.style.padding = '8px 10px';
clockEl.style.borderRadius = '8px';
clockEl.style.fontSize = '13px';
clockEl.style.backdropFilter = 'blur(6px)';
clockEl.style.border = '1px solid rgba(255,255,255,0.04)';
clockEl.textContent = '--:--';
document.body.appendChild(clockEl);

function updateClock(){
  const d = new Date();
  const hh = String(d.getHours()).padStart(2,'0');
  const mm = String(d.getMinutes()).padStart(2,'0');
  clockEl.textContent = hh + ':' + mm;
}
updateClock(); setInterval(updateClock, 60*1000);

/* ---------------------------
  Dual Mode: Privacy vs Gold
--------------------------- */
function setMode(mode){
  if (mode === 'gold'){
    document.documentElement.style.setProperty('--zcash-gold', '#F3B611');
    document.documentElement.style.setProperty('--gold-glow', 'rgba(243,182,17,0.18)');
    document.body.style.background = 'linear-gradient(180deg,#070707,#000000)';
    modeGold.classList.add('active'); modePrivacy.classList.remove('active');
  } else {
    // privacy mode (dark + green accent)
    document.documentElement.style.setProperty('--zcash-gold', '#57a88a');
    document.documentElement.style.setProperty('--gold-glow', 'rgba(87,168,138,0.12)');
    document.body.style.background = 'linear-gradient(180deg,#000000,#050505)';
    modePrivacy.classList.add('active'); modeGold.classList.remove('active');
  }
}
// initial privacy mode
setMode('privacy');
modePrivacy.addEventListener('click', ()=> setMode('privacy'));
modeGold.addEventListener('click', ()=> setMode('gold'));

/* ---------------------------
  Minimal hidden audio/player (kept available)
  - Controls hidden by default; reveal with playerToggle button
--------------------------- */
const controlsWrapEl = document.getElementById('controls');
playerToggle.addEventListener('click', ()=>{
  controlsWrapEl.classList.toggle('show');
  // update aria-hidden
  const shown = controlsWrapEl.classList.contains('show');
  controlsWrapEl.setAttribute('aria-hidden', !shown);
});

// Station endpoints (direct streams)
const stations = {
  delta: { name: 'Delta Radio â€” Live', url: 'https://streams.deltaradio.de/delta-live/mp3-192/streams.deltaradio.de/' },
  sun_sp4: { name: 'Sunshine Live â€” Tech House', url: 'https://stream.sunshine-live.de/sp4/mp3-192/utm_source=radio.menu/' },
  sun_sp6: { name: 'Sunshine Live â€” Charts', url: 'https://stream.sunshine-live.de/sp6/mp3-192/utm_source=radio.menu/' }
};

// controls bindings
document.getElementById('stationDelta').addEventListener('click', ()=> setStation(stations.delta.url));
document.getElementById('stationSunSP4').addEventListener('click', ()=> setStation(stations.sun_sp4.url));
document.getElementById('stationSunSP6').addEventListener('click', ()=> setStation(stations.sun_sp6.url));
document.getElementById('stopBtn').addEventListener('click', ()=> stopAudio());
document.getElementById('muteBtn').addEventListener('click', ()=> toggleMute());

let audioCtx = null;
let analyser = null;
let dataArray = null;
let sourceNode = null;
let vizInterval = null;
let isPlaying = false;
let isMuted = false;

function looksLikeStreamUrl(url){
  return /(\.mp3$|\.aac$|\/mp3-|\/aac-|\/stream\/|icecast|shoutcast|\/play\.pls|\/play\.m3u|\/mp3-)/i.test(url);
}

function initAudioGraph(){
  if (audioCtx) return;
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  analyser = audioCtx.createAnalyser();
  analyser.fftSize = 256;
  dataArray = new Uint8Array(analyser.frequencyBinCount);
  try {
    sourceNode = audioCtx.createMediaElementSource(radioEl);
    sourceNode.connect(analyser);
    analyser.connect(audioCtx.destination);
  } catch(err){
    console.warn('createMediaElementSource failed (CORS or unsupported):', err);
  }
  applyBeatGlowFromAnalyser(analyser, dataArray);
}

async function setStation(url){
  stopAudio();
  if (!looksLikeStreamUrl(url)){
    const open = confirm('This link might not be a direct audio stream. Open it in a new tab to inspect/copy a direct stream URL?');
    if (open) window.open(url, '_blank');
    return;
  }
  radioEl.src = url;
  radioEl.load();
  try {
    initAudioGraph();
    await audioCtx.resume();
  } catch(e){}
  await startAudio();
}

async function startAudio(){
  if (!radioEl.src){
    alert('No station selected.');
    return;
  }
  if (!audioCtx) initAudioGraph();
  try { await radioEl.play(); } catch(e){
    console.warn('play() failed:', e);
    alert('Playback failed (CORS/autoplay policy). Try clicking again or open station page.');
    return;
  }
  isPlaying = true;
  startVisualizer();
  // subtle vinyl animate (if present)
  document.getElementById('vinyl')?.classList?.add('playing');
}

function stopAudio(){
  try { radioEl.pause(); } catch(e){}
  try { radioEl.removeAttribute('src'); radioEl.load(); } catch(e){}
  try {
    if (audioCtx) {
      if (sourceNode) { try { sourceNode.disconnect(); } catch(e){} sourceNode = null; }
      try { analyser.disconnect(); } catch(e){}
      analyser = null;
      try { audioCtx.close(); } catch(e){}
      audioCtx = null;
    }
  } catch(e){}
  isPlaying = false;
  stopVisualizer();
  document.getElementById('vinyl')?.classList?.remove('playing');
}
function toggleMute(){
  isMuted = !isMuted;
  radioEl.muted = isMuted;
  document.getElementById('muteBtn').textContent = isMuted ? 'Unmute' : 'Mute';
}

// beat-synced glow for price (uses analyser)
function applyBeatGlowFromAnalyser(analyserNode, arr){
  if (!analyserNode || !arr) return;
  if (applyBeatGlowFromAnalyser._id) return;
  applyBeatGlowFromAnalyser._id = setInterval(()=>{
    try {
      analyserNode.getByteFrequencyData(arr);
      let sum = 0;
      const maxIndex = Math.floor(arr.length * 0.25);
      for (let i=0;i<maxIndex;i++) sum += arr[i];
      const avg = sum / Math.max(1,maxIndex);
      if (avg > 90) {
        priceEl.classList.add('glow');
        setTimeout(()=> priceEl.classList.remove('glow'), 160);
      } else if (avg > 45) {
        priceEl.classList.add('glow');
        setTimeout(()=> priceEl.classList.remove('glow'), 90);
      }
    } catch(e){}
  }, 35);
}

// visualizer driven by analyser (bars are not in DOM in this minimal view but logic kept)
function startVisualizer(){
  if (!analyser || !dataArray) return;
  clearInterval(vizInterval);
  vizInterval = setInterval(()=>{
    try {
      analyser.getByteFrequencyData(dataArray);
      // Possibility: if you later show bars, they will respond. For now we keep logic ready.
    } catch(e){}
  }, 80);
}
function stopVisualizer(){ clearInterval(vizInterval); vizInterval = null; }

/* Accessible helper -> set station from console: window.setStationUrl(url) */
window.setStationUrl = function(url, autoplay = true){
  if(!url) return;
  stopAudio();
  radioEl.src = url;
  radioEl.load();
  if (autoplay) startAudio();
};

/* ---------------------------
  Small niceties: keyboard toggle for player controls (press 'p') and space to pause/play audio (if controls shown)
--------------------------- */
document.addEventListener('keydown', (e)=>{
  if (e.key === 'p') {
    controlsWrapEl.classList.toggle('show');
  } else if (e.code === 'Space') {
    // if controls visible and audio has src toggle play/stop
    if (controlsWrapEl.classList.contains('show') && radioEl.src) {
      e.preventDefault();
      if (isPlaying) stopAudio();
      else startAudio();
    }
  }
});

</script>
</body>
</html>
