<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Zcash Live â€” Shield Reveal</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&display=swap" rel="stylesheet">

<style>
:root{
  --zcash-gold: #57a88a;
  --gold-glow: rgba(87,168,138,0.12);
  --bg-dark: #000;
  --privacy-green: #57a88a;
  --accent-bright: #57a88a;
  --accent-down: #ff85a1;
}

/* basics */
html,body{height:100%;margin:0;background:var(--bg-dark);color:var(--zcash-gold);font-family:Inter, "Helvetica Neue", Arial, sans-serif;overflow:auto;}
.hex-wallpaper{position:fixed;inset:0;z-index:0;pointer-events:none;opacity:0.03;color:#f3b611;font-family:ui-monospace,monospace;font-size:10px;display:flex;flex-wrap:wrap;align-items:center;justify-content:center;letter-spacing:6px;transform:translate3d(0,0,0);background:repeating-linear-gradient(90deg,transparent 0 10px, rgba(255,255,255,0.002) 10px 11px);will-change:transform,opacity}
.hex-wallpaper .line{width:100%;text-align:center;white-space:nowrap;user-select:none;opacity:0.85}
@keyframes hexDrift{from{transform:translateX(-4%)}to{transform:translateX(4%)}}
.hex-wallpaper .line{animation:hexDrift 30s linear infinite alternate}

/* center & shield */
.center{position:relative;z-index:2;min-height:100vh;display:flex;align-items:center;justify-content:center;flex-direction:column;padding:32px;box-sizing:border-box}
.shield{position:relative;width:min(84vw,920px);max-width:920px;display:flex;align-items:center;justify-content:center;padding:48px 26px;box-sizing:border-box;gap:18px;max-height:calc(100vh - 120px);overflow:visible;transition:box-shadow 240ms ease,transform 180ms ease}
.shield-bg{position:absolute;inset:0;border-radius:22px;z-index:0;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.14));border:1px solid rgba(255,255,255,0.04);backdrop-filter:blur(8px) saturate(1.05);box-shadow:0 18px 80px rgba(0,0,0,0.6), 0 4px 18px rgba(243,182,17,0.03)}
.shield-frame{position:absolute;z-index:1;left:50%;top:18px;transform:translateX(-50%);width:86%;opacity:0.24;pointer-events:none}
.block-pulse{position:absolute;z-index:1;width:42%;height:48%;background:linear-gradient(180deg, rgba(243,182,17,0.06), rgba(243,182,17,0.03));border-radius:6px;transform:translateY(6%) scale(1);transition:transform 180ms ease,box-shadow 180ms ease,opacity 200ms ease;filter:blur(0.6px);display:block;will-change:transform,box-shadow,opacity}

/* price area */
.price-wrap{position:relative;z-index:3;display:flex;align-items:center;justify-content:center;flex-direction:column;width:100%;gap:10px;padding:12px;box-sizing:border-box}
.price{font-family:'Orbitron',system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;font-weight:700;font-size:clamp(36px,12vw,124px);line-height:0.9;letter-spacing:-0.02em;color:var(--zcash-gold);text-align:center;position:relative;z-index:3;-webkit-font-smoothing:antialiased;transition:opacity 220ms ease,transform 180ms cubic-bezier(.2,.9,.3,1);opacity:0.95;will-change:opacity,transform}
.price::after{content:"";position:absolute;inset:auto -8% -8% -8%;z-index:-1;background:radial-gradient(closest-side,var(--gold-glow),transparent 40%);filter:blur(16px);opacity:0.9;pointer-events:none}

/* blinking price animation */
@keyframes blinkPrice {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.45; }
}
.price.blinking {
  animation: blinkPrice 1.4s infinite;
}

/* zec details */
.zec-details{width:100%;display:flex;justify-content:center;gap:18px;margin-top:6px;pointer-events:none}
.zec-card{
  pointer-events:auto;
  background:rgba(255,255,255,0.01);
  border-radius:10px;
  padding:8px 12px;
  border:1px solid rgba(255,255,255,0.03);
  display:flex;
  gap:12px;
  align-items:center;
  color:var(--zcash-gold);
  font-size:13px;
}

/* party list */
.party-list{position:relative;z-index:4;width:100%;max-height:220px;overflow:auto;display:none;flex-direction:column;gap:8px;pointer-events:auto;margin-top:8px}
.shield.party-active .party-list{display:flex}

/* project rows */
.project-row{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:8px 12px;border-radius:8px;background:rgba(255,255,255,0.01);border:1px solid rgba(255,255,255,0.02)}
.project-left{display:flex;flex-direction:column;gap:2px}
.project-title{font-weight:800;font-size:14px;color:var(--zcash-gold)}
.project-ticker{font-size:12px;opacity:0.8;color:var(--zcash-gold)}
.project-right{text-align:right;min-width:170px;display:flex;flex-direction:column;gap:2px;align-items:flex-end;font-size:13px;color:var(--zcash-gold)}

/* top-right mode toggle (shifted left) */
.mode-toggle{
  position:fixed;
  right:40px;   /* moved left from 12px */
  top:12px;
  z-index:6;
  display:flex;
  gap:8px;
  align-items:center;
  background:rgba(255,255,255,0.02);
  border-radius:8px;
  padding:6px;
  border:1px solid rgba(255,255,255,0.04);
  backdrop-filter:blur(6px)
}
.mode-toggle button{background:transparent;border:0;color:#fff;padding:8px 10px;border-radius:6px;cursor:pointer;font-weight:700;opacity:0.9}
.mode-toggle button.active{background:linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));color:var(--zcash-gold)}

/* player toggle */
.player-toggle{position:fixed;right:12px;bottom:12px;z-index:6;background:rgba(255,255,255,0.02);border-radius:8px;padding:8px;width:44px;height:44px;display:flex;align-items:center;justify-content:center;cursor:pointer;border:1px solid rgba(255,255,255,0.04);color:white}
.controls{position:fixed;right:12px;bottom:70px;z-index:7;display:flex;flex-direction:column;gap:8px;opacity:0;transform:translateY(8px);pointer-events:none}
.controls.show{opacity:1;transform:none;pointer-events:auto}
.controls .btn{appearance:none;border-radius:8px;padding:8px 12px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#fff;cursor:pointer;font-weight:700}

/* party button */
.party-btn{position:fixed;right:70px;bottom:12px;z-index:6;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.18));color:var(--zcash-gold);border:1px solid rgba(255,255,255,0.04);padding:8px 12px;border-radius:8px;font-weight:700;cursor:pointer;backdrop-filter:blur(6px)}
.party-back{margin-top:8px;background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--zcash-gold);padding:6px 10px;border-radius:8px;cursor:pointer;font-weight:700}

/* responsive */
@media(max-width:640px){.party-list{max-height:180px}.project-right{min-width:130px;font-size:12px}.party-btn{right:84px}}
</style>
</head>

<body>

  <!-- wallpaper -->
  <div class="hex-wallpaper" aria-hidden="true">
    <div class="line">3f a1 0c 9b 4d 8e f2 7a c9 1b 55 aa 7f e3 2d</div>
    <div class="line">b4 6a 9d 0f e1 3c 7b dd 18 90 2a 5e 33 c1 8f</div>
    <div class="line">9c e4 1b 7f 2d 5a 80 3c b1 4e 6a 0f d3 77 9a</div>
  </div>

  <div class="center">
    <div class="shield reveal-ready" id="shieldRoot">
      <div class="shield-bg"></div>
      <div class="block-pulse" id="blockPulse"></div>
      <svg class="shield-frame" viewBox="0 0 100 120">
        <path d="M50 4 L86 18 V48 C86 78 66 106 50 116 34 106 14 78 14 48 V18 Z"
              fill="none" stroke="currentColor" stroke-width="1.5"/>
      </svg>

      <div class="price-wrap">
        <div class="price" id="price">â€”</div>

        <div class="zec-details" id="zecDetails">
          <div class="zec-card" id="zecCard">
            <div style="font-weight:900">ZEC</div>
            <div><div style="font-size:12px;opacity:0.85">Supply</div><div id="zecSupply" style="font-weight:700">â€”</div></div>
            <div><div style="font-size:12px;opacity:0.85">Market cap</div><div id="zecMarketCap" style="font-weight:700">â€”</div></div>
          </div>
        </div>

        <div class="party-list" id="partyList"></div>

        <div id="partyControls" style="display:none;pointer-events:auto">
          <button id="partyBack" class="party-back">Go Back</button>
        </div>
      </div>
    </div>
  </div>

  <!-- mode buttons -->
  <div class="mode-toggle">
    <button id="modePrivacy" class="active">Privacy</button>
    <button id="modeGold">Gold</button>
  </div>

  <!-- radio -->
  <button class="player-toggle" id="playerToggle">ðŸŽ§</button>
  <div class="controls" id="controls">
    <button class="btn station" id="stationDelta">Delta Radio â€” Live</button>
    <button class="btn station" id="stationSunSP6">Sunshine Charts</button>
    <button class="btn" id="stopBtn">Stop</button>
    <button class="btn" id="muteBtn">Mute</button>
  </div>
  <audio id="radio" crossorigin="anonymous" preload="none"></audio>

  <!-- party button -->
  <button id="partyBtn" class="party-btn">ZEC Flippening Party</button>

<script>
/* ------------- Elements ------------- */
const priceEl = document.getElementById('price');
const shieldRoot = document.getElementById('shieldRoot');
const partyList = document.getElementById('partyList');
const partyBtn = document.getElementById('partyBtn');
const partyBack = document.getElementById('partyBack');
const partyControls = document.getElementById('partyControls');
const zecSupplyEl = document.getElementById('zecSupply');
const zecMarketCapEl = document.getElementById('zecMarketCap');

const playerToggle = document.getElementById('playerToggle');
const controlsWrapEl = document.getElementById('controls');
const muteBtn = document.getElementById('muteBtn');

const modePrivacy = document.getElementById('modePrivacy');
const modeGold = document.getElementById('modeGold');

const radioEl = document.getElementById('radio');

/* Formatters */
const formatMoneyCompact = v => {
  if (!isFinite(v)) return 'â€”';
  if (Math.abs(v) >= 1e12) return '$' + (v/1e12).toFixed(2) + 'T';
  if (Math.abs(v) >= 1e9) return '$' + (v/1e9).toFixed(2) + 'B';
  if (Math.abs(v) >= 1e6) return '$' + (v/1e6).toFixed(2) + 'M';
  if (Math.abs(v) >= 1e3) return '$' + (v/1e3).toFixed(2) + 'k';
  return '$' + Number(v).toLocaleString('en-US', {maximumFractionDigits:2});
};
const formatPriceFull = v => isFinite(v) ? '$' + Number(v).toLocaleString('en-US', {maximumFractionDigits:6}) : 'â€”';

/* Price polling */
async function fetchZecPrice(){
  try {
    const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=zcash&vs_currencies=usd');
    if (!res.ok) throw new Error('price fetch failed');
    const json = await res.json();
    const val = json?.zcash?.usd;
    if (val == null) throw new Error('bad response');
    priceEl.textContent = formatPriceFull(val);

    /* blink animation */
    priceEl.classList.add('blinking');
    setTimeout(() => priceEl.classList.remove('blinking'), 1400);

  } catch (e) {
    console.warn('fetchZecPrice error', e);
  }
}

async function fetchZecDetails(){
  try {
    const r = await fetch('https://api.coingecko.com/api/v3/coins/zcash?localization=false&tickers=false&market_data=true');
    if (!r.ok) throw new Error('zcash details failed');
    const j = await r.json();
    const s = j?.market_data?.circulating_supply ?? j?.circulating_supply ?? null;
    const m = j?.market_data?.market_cap?.usd ?? null;
    if (s) zecSupplyEl.textContent = Number(s).toLocaleString('en-US', {maximumFractionDigits:0}) + ' ZEC';
    if (m) zecMarketCapEl.textContent = formatMoneyCompact(m);
  } catch(e){
    console.warn('fetchZecDetails error', e);
  }
}
fetchZecPrice();
fetchZecDetails();
setInterval(fetchZecPrice, 15000);
setInterval(fetchZecDetails, 60000);

/* Audio player (unchanged from your original except formatting) */
let audioCtx = null, analyser = null, dataArray = null, sourceNode = null, isPlaying=false, isMuted=false;

function looksLikeStreamUrl(url){
  return /(\.mp3(\?|$)|\.aac(\?|$)|\/mp3-|\/aac-|\/stream\/|icecast|shoutcast|\/play\.pls|\/play\.m3u|\/mp3-)/i.test(url);
}

function initAudioGraph(){
  if (audioCtx) return;
  try {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    analyser = audioCtx.createAnalyser();
    analyser.fftSize = 256;
    dataArray = new Uint8Array(analyser.frequencyBinCount);
    try {
      sourceNode = audioCtx.createMediaElementSource(radioEl);
      sourceNode.connect(analyser);
      analyser.connect(audioCtx.destination);
    } catch(err){
      console.warn('Audio graph issue:', err);
    }
  } catch(err){
    console.warn('AudioContext unavailable:', err);
    audioCtx = null;
  }
}

async function setStation(url){
  stopAudio();
  if (!looksLikeStreamUrl(url)) {
    if (confirm('This link may not be a direct stream. Open it in a new tab?')) window.open(url, '_blank');
    return;
  }
  radioEl.src = url;
  radioEl.load();
  try { initAudioGraph(); if (audioCtx) await audioCtx.resume(); } catch(e){}
  try { await radioEl.play(); isPlaying=true; } catch(e){ alert('Playback failed.'); }
}

function stopAudio(){
  try { radioEl.pause(); } catch(e){}
  try { radioEl.removeAttribute('src'); radioEl.load(); } catch(e){}
  try { if (audioCtx) audioCtx.close(); } catch(e){}
  audioCtx = null;
  isPlaying = false;
}

function toggleMute(){
  isMuted = !isMuted;
  radioEl.muted = isMuted;
  muteBtn.textContent = isMuted ? 'Unmute' : 'Mute';
}

/* station buttons */
document.getElementById('stationDelta').addEventListener('click', ()=> setStation('https://streams.deltaradio.de/delta-live/mp3-192/streams.deltaradio.de/'));
document.getElementById('stationSunSP6').addEventListener('click', ()=> setStation('https://stream.sunshine-live.de/sp6/mp3-192/utm_source=radio.menu/'));
document.getElementById('stopBtn').addEventListener('click', stopAudio);
muteBtn.addEventListener('click', toggleMute);

/* Player toggle */
playerToggle.addEventListener('click', (e)=>{
  e.stopPropagation();
  const shown = controlsWrapEl.classList.toggle('show');
  controlsWrapEl.setAttribute('aria-hidden', String(!shown));
  playerToggle.setAttribute('aria-expanded', String(shown));
});

/* close player if clicking outside */
document.addEventListener('click', (e)=>{
  if (!controlsWrapEl.classList.contains('show')) return;
  if (playerToggle.contains(e.target) || controlsWrapEl.contains(e.target)) return;
  controlsWrapEl.classList.remove('show');
});

/* Party mode */
let partyActive = false;
partyBtn.addEventListener('click', async (e) => {
  e.stopPropagation();
  if (!partyActive) await openParty();
  else closeParty();
});
partyBack.addEventListener('click', closeParty);

async function openParty(){
  partyActive = true;
  partyBtn.setAttribute('aria-pressed','true');
  shieldRoot.classList.add('party-active');
  partyControls.style.display = 'block';
  partyList.setAttribute('aria-hidden','false');
  await loadPartyData();
}

function closeParty(){
  partyActive = false;
  partyBtn.setAttribute('aria-pressed','false');
  shieldRoot.classList.remove('party-active');
  partyControls.style.display = 'none';
  partyList.setAttribute('aria-hidden','true');
}

async function loadPartyData(){
  partyList.innerHTML = '<div class="project-row" style="justify-content:center"><div style="opacity:0.85">Loadingâ€¦</div></div>';

  try {
    const zResp = await fetch('https://api.coingecko.com/api/v3/coins/zcash?localization=false&tickers=false&market_data=true');
    const zJson = await zResp.json();
    const zecSupply = zJson?.market_data?.circulating_supply ?? null;

    const mResp = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=100&page=1');
    const markets = await mResp.json();
    const zIndex = markets.findIndex(c => c.id === 'zcash' || (c.symbol||'').toLowerCase() === 'zec');

    let twoAbove = [];
    if (zIndex >= 0) twoAbove = markets.slice(Math.max(0,zIndex-2), zIndex).reverse();
    if (twoAbove.length<2) twoAbove = markets.filter(c => c.id !== 'zcash').slice(0,2);

    const btc = markets.find(c => c.id === 'bitcoin');
    const ids = new Set(twoAbove.map(i=>i.id));
    if (btc && !ids.has('bitcoin')) twoAbove.push(btc);
    else {
      const filler = markets.find(c => c.id !== 'zcash' && !ids.has(c.id));
      if (filler) twoAbove.push(filler);
    }
    const final = twoAbove.slice(0,3);

    partyList.innerHTML = '';
    for (const proj of final) {
      const mcap = proj.market_cap;
      const price = proj.current_price;
      const zecIf = (zecSupply && mcap) ? mcap / zecSupply : NaN;
      partyList.innerHTML += `
        <div class="project-row">
          <div class="project-left">
            <div class="project-title">${proj.name}</div>
            <div class="project-ticker">${(proj.symbol||'').toUpperCase()}</div>
          </div>
          <div class="project-right">
            <div>${formatMoneyCompact(mcap)}</div>
            <div style="opacity:0.85">${formatPriceFull(price)} Â· ZEC @ cap: <strong>${isFinite(zecIf)?'$'+zecIf.toLocaleString('en-US',{maximumFractionDigits:2}):'â€”'}</strong></div>
          </div>
        </div>`;
    }

  } catch(err){
    partyList.innerHTML = '<div class="project-row" style="justify-content:center;color:#ff8080;font-weight:700">Failed to load party data</div>';
  }
}

/* Mode toggles */
function setMode(mode){
  if (mode === 'gold') {
    document.documentElement.style.setProperty('--zcash-gold','#F3B611');
    document.documentElement.style.setProperty('--gold-glow','rgba(243,182,17,0.18)');
    modeGold.classList.add('active');
    modePrivacy.classList.remove('active');
  } else {
    document.documentElement.style.setProperty('--zcash-gold','#57a88a');
    document.documentElement.style.setProperty('--gold-glow','rgba(87,168,138,0.12)');
    modePrivacy.classList.add('active');
    modeGold.classList.remove('active');
  }
}
setMode('privacy');
modePrivacy.addEventListener('click', ()=> setMode('privacy'));
modeGold.addEventListener('click', ()=> setMode('gold'));
</script>
</body>
</html>
